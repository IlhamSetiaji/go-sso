{{define "content"}}
<div class="page-title">
  <div class="row">
    <div class="col-12 col-md-6 order-md-1 order-last">
      <h3>Employees</h3>
    </div>
    <div class="col-12 col-md-6 order-md-2 order-first">
      <nav
        aria-label="breadcrumb"
        class="breadcrumb-header float-start float-lg-end"
      >
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="#">Employees</a></li>
        </ol>
      </nav>
    </div>
  </div>
</div>
<section class="section">
  <div class="card">
    <div class="card-header d-grid gap-3">
      <div class="row">
        <div class="col-md-6">
          {{if call .HasPermission "create-employee"}}
          <button
            type="button"
            class="btn btn-outline-success"
            data-bs-toggle="modal"
            data-bs-target="#xlarge"
          >
            Create New Employee
          </button>
          {{end}}
        </div>
      </div>
    </div>
    <div class="card-body">
      <table id="usersTable" class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>User Name</th>
            <th>Name</th>
            <th>Email</th>
            <th>Mobile Phone</th>
            <th>Organization Name</th>
            <th>End Date</th>
            <th>Retirement Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {{range .Employees}}
          <tr>
            <td>{{.ID}}</td>
            <td>{{.User.Name}}</td>
            <td>{{.Name}}</td>
            <td>{{.Email}}</td>
            <td>{{.MobilePhone}}</td>
            <td>{{.Organization.Name}}</td>
            <td>{{call $.DateFormatter .EndDate}}</td>
            <td>{{call $.DateFormatter .RetirementDate}}</td>
            <td>
              {{if call $.HasPermission "delete-employee"}}
              <form
                action="/roles/resign-permissions"
                method="POST"
                class="d-inline"
              >
                <input type="hidden" name="id" value="{{.ID}}" />
                <input type="hidden" name="_csrf" value="{{$.CsrfToken}}" />
                <button
                  type="button"
                  id="hapus"
                  data-id="{{.ID}}"
                  class="hapus btn btn-outline-danger"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </form>
              {{end}}
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{if call .HasPermission "create-employee"}}
    {{end}}
  </div>
  {{end}} {{define "custom-script"}}
  <script>
    $(document).ready(function () {
      $("#usersTable").DataTable();

      $(".hapus").on("click", function () {
        const id = $(this).data("id");
        Swal.fire({
          title: "Are you sure?",
          text: "You won't be able to revert this!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes, delete it!",
        }).then((result) => {
          if (result.isConfirmed) {
            $(this).parent().submit();
          }
        });
      });
    });
  </script>
  {{end}}
</section>
